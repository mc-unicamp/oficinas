{"version":3,"file":"area-plugin.min.js","sources":["../src/background.js","../src/restrictor.js","../src/snap.js","../src/utils.js","../src/index.js","../src/zoom-at.js"],"sourcesContent":["export class Background {\n    constructor(editor, element) {\n        if (!element) return;\n        const el = element instanceof HTMLElement ? element : document.createElement('div');\n     \n        el.classList += ` rete-background ${element === true ? 'default' : ''}`;\n        editor.view.area.appendChild(el);\n    }\n}","export class Restrictor {\n    constructor(editor, scaleExtent, translateExtent) {\n        this.editor = editor;\n        this.scaleExtent = scaleExtent;\n        this.translateExtent = translateExtent;\n\n        if (scaleExtent)\n            editor.on('zoom', this.restrictZoom.bind(this));\n        if (translateExtent)\n            editor.on('translate', this.restrictTranslate.bind(this));\n    }\n\n    restrictZoom(data) {\n        const se = typeof this.scaleExtent === 'boolean' ? { min: 0.1, max: 1 } : this.scaleExtent;\n        const tr = data.transform;\n\n        if (data.zoom < se.min)\n            data.zoom = se.min;\n        else if (data.zoom > se.max)\n            data.zoom = se.max;\n    }\n\n    restrictTranslate(data) {\n        const te = typeof this.translateExtent === 'boolean' ? { width: 5000, height: 4000 } : this.translateExtent;\n        const { container } = this.editor.view;\n        const k = data.transform.k;\n        const [kw, kh] = [te.width * k, te.height * k];\n        const cx = container.clientWidth / 2;\n        const cy = container.clientHeight / 2;\n\n        data.x -= cx;\n        data.y -= cy;\n        \n        if (data.x > kw)\n            data.x = kw;\n        else if (data.x < - kw)\n            data.x = - kw;\n        \n        if (data.y > kh)\n            data.y = kh;\n        else if (data.y < - kh)\n            data.y = - kh;\n        \n        data.x += cx;\n        data.y += cy;\n    }\n}","export class SnapGrid {\n    constructor(editor, { size = 16, dynamic = true }) {\n        this.editor = editor;\n        this.size = size;\n\n        if (dynamic)\n            this.editor.on('nodetranslate', this.onTranslate.bind(this))\n        else\n            this.editor.on('rendernode', ({ node, el }) => {\n                el.addEventListener('mouseup', this.onDrag.bind(this, node));\n                el.addEventListener('touchend', this.onDrag.bind(this, node));\n                el.addEventListener('touchcancel', this.onDrag.bind(this, node));\n            });\n    }\n\n    onTranslate(data) {\n        const { x, y } = data;\n\n        data.x = this.snap(x);\n        data.y = this.snap(y);\n    }\n\n    onDrag(node) {\n        const [ x, y ] = node.position;\n\n        node.position[0] = this.snap(x);\n        node.position[1] = this.snap(y);\n        console.log(this, x, y, node.position)\n        \n        this.editor.view.nodes.get(node).update();\n        this.editor.view.updateConnections({ node });\n    }\n    \n    snap(value) {\n        return Math.round(value/this.size) * this.size;\n    }\n}","const min = (arr) => arr.length === 0 ? 0 : Math.min(...arr);\nconst max = (arr) => arr.length === 0 ? 0 : Math.max(...arr);\n\nexport function nodesBBox(editor, nodes) {\n    const left = min(nodes.map(node => node.position[0]));\n    const top = min(nodes.map(node => node.position[1]));\n    const right = max(nodes.map(node => node.position[0] + editor.view.nodes.get(node).el.clientWidth));\n    const bottom = max(nodes.map(node => node.position[1] + editor.view.nodes.get(node).el.clientHeight));\n    \n    return {\n        left,\n        right,\n        top,\n        bottom,\n        width: Math.abs(left - right),\n        height: Math.abs(top - bottom),\n        getCenter: () => {\n            return [\n                (left + right) / 2,\n                (top + bottom) / 2\n            ];\n        }\n    };\n}","import './style.sass';\nimport { Background } from './background';\nimport { Restrictor } from './restrictor';\nimport { SnapGrid } from './snap';\nimport { zoomAt } from './zoom-at';\n\nfunction install(editor, params) {\n    let background = params.background || false;\n    let snap = params.snap || false;\n    let scaleExtent = params.scaleExtent || false;\n    let translateExtent = params.translateExtent || false;\n\n    if (background) {\n        this._background = new Background(editor, background);\n    }\n    if (scaleExtent || translateExtent) {\n        this._restrictor = new Restrictor(editor, scaleExtent, translateExtent)\n    }\n    if (snap) {\n        this._snap = new SnapGrid(editor, snap);\n    }\n}    \n\nexport default {\n    install,\n    zoomAt\n}","import { nodesBBox } from './utils';\n\nexport function zoomAt(editor, nodes = editor.nodes) {\n    const bbox = nodesBBox(editor, nodes);\n    const [x, y] = bbox.getCenter();\n    const [w, h] = [editor.view.container.clientWidth, editor.view.container.clientHeight];\n    const { area } = editor.view;\n\n    var [kw, kh] = [w / bbox.width, h / bbox.height]\n    var k = Math.min(kh * 0.9, kw * 0.9, 1);\n\n    area.transform.x = area.container.clientWidth / 2 - x * k;\n    area.transform.y = area.container.clientHeight / 2 - y * k;\n    area.zoom(k, 0, 0);\n    \n    area.update();\n}"],"names":["Background","editor","element","el","HTMLElement","document","createElement","classList","view","area","appendChild","Restrictor","scaleExtent","translateExtent","on","this","restrictZoom","bind","restrictTranslate","data","se","min","max","transform","zoom","te","width","height","container","k","kw","kh","cx","clientWidth","cy","clientHeight","x","y","SnapGrid","size","dynamic","onTranslate","node","addEventListener","_this","onDrag","snap","position","console","log","nodes","get","update","updateConnections","value","Math","round","arr","length","install","params","background","_background","_restrictor","_snap","zoomAt","left","top","right","bottom","bbox","map","abs","getCenter","w","h"],"mappings":"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"}